<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>QSO Assistant</title>
  
  <!-- Strict CSP for Offline Use -->
  <meta
    http-equiv="Content-Security-Policy"
    content="
      default-src 'self'; 
      script-src 'self' 'unsafe-inline'; 
      style-src 'self' 'unsafe-inline'; 
      font-src 'self' data:;
      img-src 'self' data: https:;
      frame-src 'self' https://maps.google.com https://www.google.com;
    "
  />
  
  <!-- Local Assets -->
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/flag-icons/css/flag-icons.min.css">
  <link rel="stylesheet" href="assets/bootstrap-icons/bootstrap-icons.css">
  
  <style>
    body {
      background-color: var(--bs-body-bg);
      color: var(--bs-body-color);
      overflow: hidden; 
      padding: 8px;
      user-select: none;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* --- UNIFIED HEADER --- */
    #unifiedHeader {
        display: flex;
        align-items: center;
        background: rgba(255,255,255,0.05); /* Subtle background */
        padding: 4px;
        border-radius: 4px;
        margin-bottom: 8px;
        height: 54px; /* Fixed height container */
        flex-shrink: 0;
    }

    /* 1. Search Input (Fixed Width) */
    .search-section {
        width: 140px; /* Fixed width (~12 chars) */
        margin-right: 10px;
        display: flex;
        align-items: center;
    }
    
    #callsignInput {
        font-weight: 800;
        text-transform: uppercase;
        font-size: 1.1rem;
        height: 42px; /* Fill header height nicely */
        background-color: var(--bs-body-bg);
        color: var(--bs-body-color);
        border: 1px solid var(--bs-border-color);
    }

    /* Wrapper for Data (Hidden by default) */
    #headerData {
        display: flex;
        flex-grow: 1;
        align-items: center;
        overflow: hidden;
    }

    /* 2. Info Section (Flag, Name, Badges) */
    .info-section {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        overflow: hidden;
        line-height: 1.1;
    }

    .info-top {
        display: flex;
        align-items: center;
        margin-bottom: 3px;
    }

    #dxccName {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-weight: 700;
        font-size: 0.95rem;
    }

    /* Badges Row */
    .badges-inline {
        display: flex;
        gap: 4px;
    }

    .status-badge {
        padding: 0 6px;
        border-radius: 3px;
        font-size: 0.65rem;
        font-weight: 700;
        background-color: var(--bs-secondary-bg);
        color: var(--bs-secondary-color);
        border: 1px solid var(--bs-border-color);
        text-transform: uppercase;
        white-space: nowrap;
        height: 20px;
        display: flex;
        align-items: center;
    }
    
    .status-active { background-color: #198754 !important; color: white !important; } 
    .status-needed { background-color: #0d6efd !important; color: white !important; } 
    .status-none   { background-color: #6c757d !important; color: white !important; opacity: 0.5; } 

    /* 3. Bearing Section (Right) */
    .bearing-section {
        text-align: right;
        min-width: 80px;
        margin-left: 8px;
        line-height: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .stat-bearing { font-size: 1.6rem; font-weight: 800; color: var(--bs-primary); }
    .stat-dist { font-size: 0.8rem; color: var(--bs-secondary); margin-top: 2px; }

    /* STATS ROW */
    #statsRow {
        display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--bs-secondary);
        margin-bottom: 5px; padding: 0 4px; flex-shrink: 0;
    }
    .stat-box { text-align: center; }
    .stat-val { font-weight: 700; color: var(--bs-primary); }
    .stat-lp { color: #fd7e14; }

    /* DX ANNOUNCEMENT ROW (NEW) */
    #dxRow { display: flex; gap: 5px; margin-bottom: 5px; flex-shrink: 0; }
    #dxComment { flex-grow: 1; font-size: 0.85rem; }

    /* Split button for Rotor (NEW) */
    .btn-split { display: flex; flex-direction: column; line-height: 0.9; font-size: 0.7rem; }    

    /* --- MEDIA & CONTROLS --- */

    .media-container {
      background: #000; 
      border-radius: 4px; 
      overflow: hidden; 
      border: 1px solid var(--bs-border-color);
      position: relative;
      height: 100%;
      display: flex; 
      align-items: center;
      justify-content: center;
    }

    #profileImg {
        width: 100%;
        height: 100%;
        object-fit: contain !important; 
    }

    /* Control Grid */
    #controlsRow {
        display: grid;
        grid-template-columns: repeat(4, 1fr); 
        gap: 5px;
        margin-top: auto; 
        width: 100%;
        flex-shrink: 0;
    }

    .btn-action {
      width: 100%;
      height: 38px;
      font-weight: 600;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      padding: 0; 
    }
  </style>
</head>
<body>

  <!-- Unified Header -->
  <div id="unifiedHeader">
      
      <!-- 1. Callsign Display (LCD Style) - Width auto-adjusts now -->
      <div class="search-section" style="flex-grow: 1; margin-right: 12px; min-width: 160px;">
          <div id="callsignDisplay" class="d-flex align-items-center justify-content-center" 
               style="background-color: #212529; color: #0dcaf0; font-family: 'Consolas', monospace; 
                      font-weight: 800; font-size: 1.8rem; height: 42px; border-radius: 4px; 
                      border: 1px solid #444; letter-spacing: 2px; overflow: hidden; white-space: nowrap; padding-left: 10px; padding-right: 10px;">
              WAITING...
          </div>
      </div>

      <!-- 2. Data Wrapper (Hidden until lookup) -->
      <div id="headerData" class="d-none">
          
          <!-- Info & Badges -->
          <div class="info-section">
              <div class="info-top">
                  <span id="flagIcon" class="fi me-2" style="font-size: 1.4em;"></span>
                  <div id="dxccName">---</div>
              </div>
              
              <div class="badges-inline">
                  <div id="statusDxcc" class="status-badge">DXCC</div>
                  <div id="statusSlot" class="status-badge">SLOT</div>
                  <div id="statusLotw" class="status-badge">LoTW</div>
                  <div id="statusOqrs" class="status-badge">OQRS</div>
              </div>
          </div>

          <!-- Bearing -->
          <div class="bearing-section">
              <div id="bearingValue" class="stat-bearing">---°</div>
              <div id="distanceValue" class="stat-dist">--- km</div>
          </div>

      </div>
  </div>

  <!-- EXTENDED INFO -->
  <div id="statsRow" class="d-none">
      <div class="stat-box">GRID: <span id="valGrid" class="stat-val">---</span></div>
      <div class="stat-box">SP: <span id="valBear" class="stat-val">---°</span> / <span id="valDist">---</span></div>
      <div class="stat-box">LP: <span id="valBearLP" class="stat-val stat-lp">---°</span> / <span id="valDistLP">---</span></div>
  </div>

  <!-- Media Row -->
  <div id="mediaRow" class="row g-2 mb-2 flex-grow-1 d-none" style="min-height: 0;">
    <div class="col-6 h-100">
      <div class="media-container" id="profileImgContainer" title="Click to enlarge" style="cursor: pointer;">
        <img id="profileImg" src="" alt="">
        <div id="noImageLabel" class="position-absolute text-muted small text-center">
          <i class="bi bi-person-x display-6"></i><br>No Image
        </div>
      </div>
    </div>
    <div class="col-6 h-100">
      <div class="media-container" id="mapContainer" title="Click to open Google Maps" style="cursor: pointer;">
        <iframe id="mapFrame" width="100%" height="100%" style="border:0;" loading="lazy"></iframe>
        <div class="position-absolute top-0 start-0 w-100 h-100"></div>
      </div>
    </div>
  </div>

  <!-- DX ANNOUNCEMENT -->
  <div id="dxRow" class="d-none">
      <input type="text" id="dxComment" class="form-control form-control-sm" placeholder="DX Comment (e.g. 5 up)">
      <button id="spotDxClusterBtn" class="btn btn-sm btn-warning fw-bold" style="white-space:nowrap;" disabled>
          <i class="bi bi-send"></i> Send Spot
      </button>
      <button id="btnDxLink" class="btn btn-sm btn-outline-secondary" title="Open DXWatch"><i class="bi bi-box-arrow-up-right"></i></button>
  </div>
  
  <!-- Control Buttons -->
  <div id="controlsRow" class="d-none">
      <button id="rotateBtnSP" class="btn btn-outline-danger btn-action btn-split"><span>ROTATE</span><span id="rotBearSP" style="font-size:1.1em;">---°</span></button>
      <button id="rotateBtnLP" class="btn btn-outline-warning btn-action btn-split"><span>LONG P</span><span id="rotBearLP" style="font-size:1.1em;">---°</span></button>
      
      <button id="spotFlexBtn" class="btn btn-outline-secondary btn-action" disabled>
          <i class="bi bi-display me-1"></i> Flex Spot
      </button>
  </div>
  
  <!-- Radio Status Footer (New) -->
  <div id="radioStatusFooter" class="text-center mt-2 text-muted small" style="display:none;">
      <i class="bi bi-exclamation-triangle-fill text-warning"></i> Radio Disconnected
  </div>

  <script src="qso_assistant.js"></script>
</body>
</html>